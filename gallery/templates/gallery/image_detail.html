<!-- image_detail.html -->
{% extends 'gallery/base.html' %}
{% load static %}

{% block content %}
<div class="image-detail">
    <h2>{{ image.title }}</h2>
    <img src="{{ image.image_file.url }}" alt="{{ image.title }}">
    <p>{{ image.description }}</p>

    <!-- Felt√∂lt≈ë megjelen√≠t√©se -->
    <p>Felt√∂lt√∂tte:
        <a href="{% url 'profile' image.uploader.username %}">
            {{ image.uploader.username }}
        </a>
    </p>

    {% if image.tags.all %}
        <p>C√≠mk√©k:
            {% for tag in image.tags.all %}
                <span class="tag">{{ tag.name }}</span>
            {% endfor %}
        </p>
    {% else %}
        <p>Nincsenek c√≠mk√©k ehhez a k√©phez.</p>
    {% endif %}

    <!-- Like √©s Dislike gombok -->
    <div class="like-dislike-buttons">
        <form action="{% url 'like_image' image.id %}" method="post">
            {% csrf_token %}
            <button type="submit" class="like-btn">
                üëç Tetszik ({{ image.total_likes }})
            </button>
        </form>
        <form action="{% url 'dislike_image' image.id %}" method="post">
            {% csrf_token %}
            <button type="submit" class="dislike-btn">
                üëé Nem tetszik ({{ image.total_dislikes }})
            </button>
        </form>
    </div>

    <!-- Kommentek megjelen√≠t√©se -->
    <div class="comments-section">
        <h3>Hozz√°sz√≥l√°sok</h3>
        {% for comment in comments %}
            {% include 'gallery/comment.html' %}
        {% empty %}
            <p>Nincsenek hozz√°sz√≥l√°sok.</p>
        {% endfor %}

        <!-- √öj hozz√°sz√≥l√°s ≈±rlapja -->
        {% if user.is_authenticated %}
            <div class="comment-input">
                <form method="post">
                    {% csrf_token %}
                    <input type="text" name="content" placeholder="Add a comment..." required>
                    <button type="submit">Post</button>
                </form>
            </div>
        {% else %}
            <p>K√©rj√ºk, <a href="{% url 'login' %}">jelentkezz be</a>, hogy hozz√°sz√≥lhass.</p>
        {% endif %}
    </div>
</div>

<!-- JavaScript a v√°lasz linkek kezel√©s√©hez -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    var replyLinks = document.querySelectorAll('.reply-link');
    replyLinks.forEach(function(link) {
        link.addEventListener('click', function(event) {
            event.preventDefault();
            var commentId = this.getAttribute('data-comment-id');
            var replyForm = document.getElementById('reply-form-' + commentId);
            replyForm.style.display = replyForm.style.display === 'none' ? 'block' : 'none';
        });
    });
});
</script>
{% endblock %}
